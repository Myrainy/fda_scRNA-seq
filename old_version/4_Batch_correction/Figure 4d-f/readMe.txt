code for figure 4d-f
