code for figure 4a-c
